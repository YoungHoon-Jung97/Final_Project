<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nutmag.project.dao.ITeamDAO">
	
	<insert id="teamInsert" parameterType="com.nutmag.project.dto.TeamDTO" statementType="CALLABLE">
        CALL PRC_TEMP_TEAM_INSERT(
            #{temp_team_name, jdbcType=VARCHAR},
            #{temp_team_desc, jdbcType=VARCHAR},
            #{emblem, jdbcType=VARCHAR},
            #{temp_team_account, jdbcType=VARCHAR},
            #{temp_team_account_holder, jdbcType=VARCHAR},
            #{bank_id},
            #{region_id},
            #{city_id},
            #{temp_team_person_count},
            #{user_code_id}
        )
    </insert>

	<select id="searchTempTeamMember" resultType="int">
		SELECT COUNT(*)
		FROM TEMP_TEAM_APPLY
		WHERE USER_CODE_ID=#{user_code_id} AND TEMP_TEAM_APPLY_APPR_AT IS NOT NULL 
	</select>
	
	<select id="searchTeamMember" resultType="int">
		SELECT COUNT(*)
		FROM team_member
		WHERE USER_CODE_ID=#{user_code_id} AND TEAM_MEMBER_APPLY_AT IS NOT NULL
	</select>
	
	<select id="searchTeamName" resultType="String">
		SELECT TEMP_TEAM_NAME
		FROM TEMP_TEAM
		WHERE TEMP_TEAM_NAME=#{teamName}
	</select>
	
	<!-- 동호회 목록 조회 -->
    <select id="getTeamList" resultType="com.nutmag.project.dto.TeamDTO">
        SELECT *
        FROM TEAM_VIEW
        ORDER BY DBMS_RANDOM.RANDOM
    </select>
    
    <!-- 동호회 정보 조회 -->
    <select id="getTeamInfo" resultType="com.nutmag.project.dto.TeamDTO">
    	SELECT *
        FROM TEAM_VIEW
        WHERE TEMP_TEAM_ID=#{teamId}
    </select>
    
    <!-- 임시 동호회 가입 신청 -->
	<insert id="addTempTeam" parameterType="com.nutmag.project.dto.TeamApplyDTO">
   	 	INSERT INTO TEMP_TEAM_APPLY(
		TEMP_TEAM_APPLY_ID,TEMP_TEAM_APPLY_DESC,
		TEMP_TEAM_APPLY_AT,TEMP_TEAM_APPLY_APPR_AT,
		USER_CODE_ID,TEMP_TEAM_ID,POSITION_ID
    	)
  		VALUES(
        	TEMP_TEAM_APPLY_SEQ.NEXTVAL,#{temp_team_apply_desc},SYSDATE,NULL,
        	#{user_code_id},#{team_id},#{position_id}
    	)
    </insert>
    
    <insert id="addTeam" parameterType="com.nutmag.project.dto.TeamApplyDTO">
   	 	INSERT INTO TEAM_MEMBER(
		TEAM_MEMBER_ID,TEAM_MEMBER_APPLY_AT,
		TEAM_MEMBER_REG_AT,TEAM_MEMBER_DESC,
		USER_CODE_ID,TEAM_ID,POSITION_ID
    	)
  		VALUES(
        	TEAM_MEMBER_SEQ.NEXTVAL,SYSDATE,NULL,#{team_member_desc},
        	#{user_code_id},#{team_id},#{position_id}
    	)
    </insert>
    
    
    <!-- ================================================================================================= -->
    
    <!-- my임시 동호회 찾기 -->
    <select id="searchMyTempTeam" resultType="Integer">
    	SELECT TEMP_TEAM_ID
		FROM TEMP_TEAM_APPLY
		WHERE USER_CODE_ID=#{user_code_id}
		AND TEMP_TEAM_APPLY_APPR_AT IS NOT NULL
    </select>
    
    <!-- my정식 동호회 찾기 -->
    <select id="searchMyTeam" resultType="Integer">
    	SELECT TEAM_ID
		FROM TEAM_WITHDRAWAL_VIEW
		WHERE USER_CODE_ID=#{user_code_id} AND
		TEAM_WITHDRAWAL_ID IS NOT NULL 
		AND TEAM_MEMBER_REG_AT IS NOT NULL
    </select>
    
    <!--정식 동호회 정보 찾기 -->
    <select id="searchTempTeam" resultType="Integer">
    	SELECT TEMP_TEAM_ID
		FROM TEAM
		WHERE TEAM_ID=${team_id};
    </select>
    
    <!-- ================================================================================================= -->
    
    <!-- 임시 동호회 인원  -->
    <select id="tempTeamMemberList" resultType="com.nutmag.project.dto.TeamApplyDTO">
    	SELECT *
		FROM TEMP_TEAM_MEMBER_VIEW
		WHERE TEMP_TEAM_ID =#{team_Id}
    </select>
    
    <!-- 정식 동호회 인원 -->
    <select id="teamMemberList" resultType="com.nutmag.project.dto.TeamApplyDTO">
    	SELECT *
    	FROM TEAM_MEMBER_VIEW
    	WHERE TEAM_ID =#{team_id} 
    </select>
    
    <!-- ================================================================================================= -->
    
</mapper>